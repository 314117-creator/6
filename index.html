<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æŠ½ç›²ç›’æ©Ÿå™¨</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f0f8ff; padding: 50px; }
    h1 { color: #ff69b4; }
    #box { width: 300px; height: 300px; margin: 20px auto; background: #fff; border: 5px dashed #ff69b4; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-direction: column; }
    button { padding: 15px 30px; font-size: 20px; background: #ff69b4; color: white; border: none; border-radius: 10px; cursor: pointer; margin-top: 20px; }
    button:hover { background: #ff1493; }
    #result { margin-top: 30px; font-size: 28px; color: #ff69b4; }
    img { max-width: 280px; max-height: 280px; border-radius: 15px; margin-top: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .loading { animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <h1>ç›²ç›’æŠ½çæ©Ÿå™¨</h1>
  <div id="box">
    <div>ğŸ</div>
    <div>é»æ“Šä¸‹é¢æŒ‰éˆ•æŠ½ç›²ç›’ï¼</div>
  </div>
  <button onclick="drawBox()">æŠ½ä¸€å€‹ç›²ç›’ï¼</button>
  <div id="result"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDh4IB8fakLIj_PAOM76uSRQtneMeRDY7o",
      authDomain: "project1225-e9577.firebaseapp.com",
      databaseURL: "https://project1225-e9577-default-rtdb.firebaseio.com/",
      projectId: "project1225-e9577",
      storageBucket: "project1225-e9577.firebasestorage.app",
      messagingSenderId: "846279084104",
      appId: "1:846279084104:web:47f58714c0354fca59307d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    async function drawBox() {
      const resultDiv = document.getElementById('result');
      const boxDiv = document.getElementById('box');
      
      resultDiv.innerHTML = '<p>æŠ½çä¸­... <span class="loading">ğŸ²</span></p>';
      boxDiv.innerHTML = '<div class="loading" style="font-size:60px;">ğŸ</div>';

      try {
        const snapshot = await get(ref(db, 'items'));
        if (snapshot.exists()) {
          const items = snapshot.val();
          const keys = Object.keys(items);
          if (keys.length === 0) {
            resultDiv.innerHTML = '<p>è³‡æ–™åº«è£¡æ²’æœ‰ç‰©å“ï¼è«‹å…ˆåŠ å…¥ç‰©å“ã€‚</p>';
            return;
          }
          const randomKey = keys[Math.floor(Math.random() * keys.length)];
          const item = items[randomKey];

          resultDiv.innerHTML = `
            <h2>æ­å–œæŠ½åˆ°ï¼</h2>
            <p><strong>${item.name || 'æœªçŸ¥ç‰©å“'}</strong></p>
            <p>ç¨€æœ‰åº¦ï¼š${item.rarity || 'æœªçŸ¥'}</p>
            <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/300?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">
          `;
          boxDiv.innerHTML = '<div>ğŸ‰</div><div>æŠ½å®Œäº†ï¼å†æŠ½ä¸€å€‹ï¼Ÿ</div>';
        } else {
          resultDiv.innerHTML = '<p style="color:red;">è³‡æ–™åº«æ²’æœ‰ã€Œitemsã€è³‡æ–™ï¼</p>';
        }
      } catch (error) {
        console.error(error);
        resultDiv.innerHTML = `<p style="color:red;">éŒ¯èª¤ï¼š${error.message}</p>`;
      }
    }
  </script>
</body>
</html>